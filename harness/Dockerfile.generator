FROM golang:1.21-alpine AS builder

WORKDIR /build

# Copy generator source
COPY generator/ ./

# Build the generator
RUN go build -o generator .

FROM alpine:latest

WORKDIR /app

# Copy the generator binary
COPY --from=builder /build/generator /usr/local/bin/generator

# Make it executable
RUN chmod +x /usr/local/bin/generator

# Default command - stream logs to ingestor
ENTRYPOINT ["generator"]
CMD ["-stream", "-delay", "1s", "-endpoint", "http://ingestor:8080/ingest", "-batch", "10"]
